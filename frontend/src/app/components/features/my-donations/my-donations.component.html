<div class="my-donations">
    <h2>üì¶ Mis Donaciones</h2>

    <!-- Loading state -->
    <div *ngIf="loading" class="loading-container">
        <div class="spinner"></div>
        <p>Cargando tus donaciones...</p>
    </div>

    <!-- Error state -->
    <div *ngIf="error && !loading" class="error-box">
        <p>‚ùå {{ error }}</p>
        <button (click)="loadMyDonations()" class="retry-button">Reintentar</button>
    </div>

    <!-- Empty state -->
    <div *ngIf="!loading && !error && tokens.length === 0" class="empty-state">
        <div class="empty-icon">üì≠</div>
        <h3>No tienes donaciones</h3>
        <p>A√∫n no has recibido ning√∫n token de donaci√≥n.</p>
    </div>

    <!-- Tokens list -->
    <div *ngIf="!loading && !error && tokens.length > 0" class="tokens-grid">
        <div *ngFor="let token of tokens" class="token-card">
            <!-- Token header -->
            <div class="token-header">
                <h3>Token #{{ token.tokenId }}</h3>
                <span *ngIf="token.data" class="status-badge" [ngClass]="getStatusClass(token.data)">
                    {{ getTokenStatus(token.data) }}
                </span>
            </div>

            <!-- Token loading -->
            <div *ngIf="token.loading" class="token-loading">
                <div class="spinner-small"></div>
                <p>Cargando datos...</p>
            </div>

            <!-- Token error -->
            <div *ngIf="token.error && !token.loading" class="token-error">
                <p>‚ö†Ô∏è {{ token.error }}</p>
            </div>

            <!-- Token data -->
            <div *ngIf="token.data && !token.loading" class="token-content">
                <!-- Description -->
                <div class="token-section">
                    <h4>üìù Descripci√≥n</h4>
                    <p>{{ token.data.description }}</p>
                </div>

                <!-- Expiration -->
                <div class="token-section">
                    <h4>‚è∞ Fecha de Expiraci√≥n</h4>
                    <p [class.expired]="isExpired(token.data.expiration)">
                        {{ formatDate(token.data.expiration) }}
                        <span *ngIf="isExpired(token.data.expiration)" class="expired-label">
                            (Expirado)
                        </span>
                    </p>
                </div>

                <!-- Locations -->
                <div class="token-section">
                    <h4>üìç Historial de Ubicaciones</h4>
                    <div class="locations-timeline">
                        <div *ngFor="let location of token.data.locations; let i = index" class="location-item"
                            [class.location-used]="location.used">
                            <div class="location-marker">
                                <span class="location-number">{{ i + 1 }}</span>
                            </div>
                            <div class="location-details">
                                <p class="location-name">
                                    {{ location.location }}
                                    <span *ngIf="location.used" class="used-badge">‚úì Utilizado</span>
                                </p>
                                <p class="location-date">{{ formatDate(location.timestamp) }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>